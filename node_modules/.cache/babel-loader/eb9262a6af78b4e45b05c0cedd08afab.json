{"ast":null,"code":"import { Vector3 } from '../math/Vector3.js';\nimport { Object3D } from '../core/Object3D.js';\n\nconst _v1 = /*@__PURE__*/new Vector3();\n\nconst _v2 = /*@__PURE__*/new Vector3();\n\nclass LOD extends Object3D {\n  constructor() {\n    super();\n    this._currentLevel = 0;\n    this.type = 'LOD';\n    Object.defineProperties(this, {\n      levels: {\n        enumerable: true,\n        value: []\n      },\n      isLOD: {\n        value: true\n      }\n    });\n    this.autoUpdate = true;\n  }\n\n  copy(source) {\n    super.copy(source, false);\n    const levels = source.levels;\n\n    for (let i = 0, l = levels.length; i < l; i++) {\n      const level = levels[i];\n      this.addLevel(level.object.clone(), level.distance);\n    }\n\n    this.autoUpdate = source.autoUpdate;\n    return this;\n  }\n\n  addLevel(object) {\n    let distance = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    distance = Math.abs(distance);\n    const levels = this.levels;\n    let l;\n\n    for (l = 0; l < levels.length; l++) {\n      if (distance < levels[l].distance) {\n        break;\n      }\n    }\n\n    levels.splice(l, 0, {\n      distance: distance,\n      object: object\n    });\n    this.add(object);\n    return this;\n  }\n\n  getCurrentLevel() {\n    return this._currentLevel;\n  }\n\n  getObjectForDistance(distance) {\n    const levels = this.levels;\n\n    if (levels.length > 0) {\n      let i, l;\n\n      for (i = 1, l = levels.length; i < l; i++) {\n        if (distance < levels[i].distance) {\n          break;\n        }\n      }\n\n      return levels[i - 1].object;\n    }\n\n    return null;\n  }\n\n  raycast(raycaster, intersects) {\n    const levels = this.levels;\n\n    if (levels.length > 0) {\n      _v1.setFromMatrixPosition(this.matrixWorld);\n\n      const distance = raycaster.ray.origin.distanceTo(_v1);\n      this.getObjectForDistance(distance).raycast(raycaster, intersects);\n    }\n  }\n\n  update(camera) {\n    const levels = this.levels;\n\n    if (levels.length > 1) {\n      _v1.setFromMatrixPosition(camera.matrixWorld);\n\n      _v2.setFromMatrixPosition(this.matrixWorld);\n\n      const distance = _v1.distanceTo(_v2) / camera.zoom;\n      levels[0].object.visible = true;\n      let i, l;\n\n      for (i = 1, l = levels.length; i < l; i++) {\n        if (distance >= levels[i].distance) {\n          levels[i - 1].object.visible = false;\n          levels[i].object.visible = true;\n        } else {\n          break;\n        }\n      }\n\n      this._currentLevel = i - 1;\n\n      for (; i < l; i++) {\n        levels[i].object.visible = false;\n      }\n    }\n  }\n\n  toJSON(meta) {\n    const data = super.toJSON(meta);\n    if (this.autoUpdate === false) data.object.autoUpdate = false;\n    data.object.levels = [];\n    const levels = this.levels;\n\n    for (let i = 0, l = levels.length; i < l; i++) {\n      const level = levels[i];\n      data.object.levels.push({\n        object: level.object.uuid,\n        distance: level.distance\n      });\n    }\n\n    return data;\n  }\n\n}\n\nexport { LOD };","map":null,"metadata":{},"sourceType":"module"}