{"ast":null,"code":"import { Matrix4 } from '../math/Matrix4.js';\nimport { Vector2 } from '../math/Vector2.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { Vector4 } from '../math/Vector4.js';\nimport { Frustum } from '../math/Frustum.js';\n\nconst _projScreenMatrix = /*@__PURE__*/new Matrix4();\n\nconst _lightPositionWorld = /*@__PURE__*/new Vector3();\n\nconst _lookTarget = /*@__PURE__*/new Vector3();\n\nclass LightShadow {\n  constructor(camera) {\n    this.camera = camera;\n    this.bias = 0;\n    this.normalBias = 0;\n    this.radius = 1;\n    this.blurSamples = 8;\n    this.mapSize = new Vector2(512, 512);\n    this.map = null;\n    this.mapPass = null;\n    this.matrix = new Matrix4();\n    this.autoUpdate = true;\n    this.needsUpdate = false;\n    this._frustum = new Frustum();\n    this._frameExtents = new Vector2(1, 1);\n    this._viewportCount = 1;\n    this._viewports = [new Vector4(0, 0, 1, 1)];\n  }\n\n  getViewportCount() {\n    return this._viewportCount;\n  }\n\n  getFrustum() {\n    return this._frustum;\n  }\n\n  updateMatrices(light) {\n    const shadowCamera = this.camera;\n    const shadowMatrix = this.matrix;\n\n    _lightPositionWorld.setFromMatrixPosition(light.matrixWorld);\n\n    shadowCamera.position.copy(_lightPositionWorld);\n\n    _lookTarget.setFromMatrixPosition(light.target.matrixWorld);\n\n    shadowCamera.lookAt(_lookTarget);\n    shadowCamera.updateMatrixWorld();\n\n    _projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse);\n\n    this._frustum.setFromProjectionMatrix(_projScreenMatrix);\n\n    shadowMatrix.set(0.5, 0.0, 0.0, 0.5, 0.0, 0.5, 0.0, 0.5, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0, 1.0);\n    shadowMatrix.multiply(shadowCamera.projectionMatrix);\n    shadowMatrix.multiply(shadowCamera.matrixWorldInverse);\n  }\n\n  getViewport(viewportIndex) {\n    return this._viewports[viewportIndex];\n  }\n\n  getFrameExtents() {\n    return this._frameExtents;\n  }\n\n  dispose() {\n    if (this.map) {\n      this.map.dispose();\n    }\n\n    if (this.mapPass) {\n      this.mapPass.dispose();\n    }\n  }\n\n  copy(source) {\n    this.camera = source.camera.clone();\n    this.bias = source.bias;\n    this.radius = source.radius;\n    this.mapSize.copy(source.mapSize);\n    return this;\n  }\n\n  clone() {\n    return new this.constructor().copy(this);\n  }\n\n  toJSON() {\n    const object = {};\n    if (this.bias !== 0) object.bias = this.bias;\n    if (this.normalBias !== 0) object.normalBias = this.normalBias;\n    if (this.radius !== 1) object.radius = this.radius;\n    if (this.mapSize.x !== 512 || this.mapSize.y !== 512) object.mapSize = this.mapSize.toArray();\n    object.camera = this.camera.toJSON(false).object;\n    delete object.camera.matrix;\n    return object;\n  }\n\n}\n\nexport { LightShadow };","map":null,"metadata":{},"sourceType":"module"}