{"ast":null,"code":"import { LineSegments } from '../objects/LineSegments.js';\nimport { Matrix4 } from '../math/Matrix4.js';\nimport { LineBasicMaterial } from '../materials/LineBasicMaterial.js';\nimport { Color } from '../math/Color.js';\nimport { Vector3 } from '../math/Vector3.js';\nimport { BufferGeometry } from '../core/BufferGeometry.js';\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\n\nconst _vector = /*@__PURE__*/new Vector3();\n\nconst _boneMatrix = /*@__PURE__*/new Matrix4();\n\nconst _matrixWorldInv = /*@__PURE__*/new Matrix4();\n\nclass SkeletonHelper extends LineSegments {\n  constructor(object) {\n    const bones = getBoneList(object);\n    const geometry = new BufferGeometry();\n    const vertices = [];\n    const colors = [];\n    const color1 = new Color(0, 0, 1);\n    const color2 = new Color(0, 1, 0);\n\n    for (let i = 0; i < bones.length; i++) {\n      const bone = bones[i];\n\n      if (bone.parent && bone.parent.isBone) {\n        vertices.push(0, 0, 0);\n        vertices.push(0, 0, 0);\n        colors.push(color1.r, color1.g, color1.b);\n        colors.push(color2.r, color2.g, color2.b);\n      }\n    }\n\n    geometry.setAttribute('position', new Float32BufferAttribute(vertices, 3));\n    geometry.setAttribute('color', new Float32BufferAttribute(colors, 3));\n    const material = new LineBasicMaterial({\n      vertexColors: true,\n      depthTest: false,\n      depthWrite: false,\n      toneMapped: false,\n      transparent: true\n    });\n    super(geometry, material);\n    this.type = 'SkeletonHelper';\n    this.isSkeletonHelper = true;\n    this.root = object;\n    this.bones = bones;\n    this.matrix = object.matrixWorld;\n    this.matrixAutoUpdate = false;\n  }\n\n  updateMatrixWorld(force) {\n    const bones = this.bones;\n    const geometry = this.geometry;\n    const position = geometry.getAttribute('position');\n\n    _matrixWorldInv.copy(this.root.matrixWorld).invert();\n\n    for (let i = 0, j = 0; i < bones.length; i++) {\n      const bone = bones[i];\n\n      if (bone.parent && bone.parent.isBone) {\n        _boneMatrix.multiplyMatrices(_matrixWorldInv, bone.matrixWorld);\n\n        _vector.setFromMatrixPosition(_boneMatrix);\n\n        position.setXYZ(j, _vector.x, _vector.y, _vector.z);\n\n        _boneMatrix.multiplyMatrices(_matrixWorldInv, bone.parent.matrixWorld);\n\n        _vector.setFromMatrixPosition(_boneMatrix);\n\n        position.setXYZ(j + 1, _vector.x, _vector.y, _vector.z);\n        j += 2;\n      }\n    }\n\n    geometry.getAttribute('position').needsUpdate = true;\n    super.updateMatrixWorld(force);\n  }\n\n}\n\nfunction getBoneList(object) {\n  const boneList = [];\n\n  if (object && object.isBone) {\n    boneList.push(object);\n  }\n\n  for (let i = 0; i < object.children.length; i++) {\n    boneList.push.apply(boneList, getBoneList(object.children[i]));\n  }\n\n  return boneList;\n}\n\nexport { SkeletonHelper };","map":null,"metadata":{},"sourceType":"module"}